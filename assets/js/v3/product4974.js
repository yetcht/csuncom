function LoginSuccess(){$("#HeadToper").load("/Head/LoginPartial")}function onQuickAdd(t){var e=(t.currentTarget?$(t.currentTarget):$(t)).parents("ul"),e=getProductMetaData(e),a={productType:e.productType,orderQty:e.orderQty,shipTo:e.shipTo,minType:e.minType,QuickAdd:"1"};isGuidEmpty(e.productguid)?isNull(e.sourcestockid)||(a.productGuid=e.sourcestockid):a.productGuid=e.productguid;"payment"==(t.currentTarget?$(t.currentTarget):$(t)).data("type")?$.post("/ShopCart/ImmediatePayment",a,function(t){"signin"==t?layer.msg(configData.ShopCart.txt31,{icon:7,time:2e3},function(){showLogin("ShopCart")}):"noexchangerate"==t?layer.confirm(configData.ShopCart.txt42,{title:configData.Layer.txt1}):"noprice"==t?layer.confirm(configData.ShopCart.txt43,{title:configData.Layer.txt1}):"error"==t?layer.confirm("该库存数据存在异常，无法购买",{title:"系统问题"}):window.location.href="/Order/Confirm?tempId="+t+"&source=''"}):$.post("/ShopCart/AddToCart",a,function(t){"ok"==t?($.ajax({url:"/ShopCart/GetShopCount",type:"GET",dataType:"text",async:!0,success:function(t){0<t?$(".ic_cart_count").show():$(".ic_cart_count").hide(),$(".cart-count").text(t),$(".minicart").removeClass("isAjax")},error:function(t){console.log(t)}}),layer.msg(configData.SearchList.txt109,{icon:1})):layer.confirm("该库存数据存在异常，无法购买",{title:"系统问题"})})}function orderQtyLess(t){var e,t=(t.currentTarget?$(t.currentTarget):$(t)).parents("ul"),a=getProductMetaData(t),n=a.orderQty-a.increment;n<a.moq?t.find("input[name=orderQty]").val(a.moq):(a.orderQty==a.invQty&&1==a.noUnpacking&&0<(e=a.invQty%a.spq)&&(n=a.invQty-e),t.find("input[name=orderQty]").val(n),checkIfNeedBook(t),calcPriceAndAmount(t))}function orderQtyAdd(t){var t=(t.currentTarget?$(t.currentTarget):$(t)).parents("ul"),e=getProductMetaData(t),a=e.orderQty+e.increment;e.invQty<e.moq&&(a<e.moq&&1==e.isSupportBook||0==e.isSupportBook)?t.find("input[name=orderQty]").val(e.moq):a>e.invQty&&0==e.isSupportBook?t.find("input[name=orderQty]").val(e.invQty):(t.find("input[name=orderQty]").val(a),checkIfNeedBook(t),calcPriceAndAmount(t))}function orderQtyBlur(t){var e,t=(t.currentTarget?$(t.currentTarget):$(t)).parents("ul"),a=getProductMetaData(t),n=t.find("input[name=orderQty]");isNaN(a.orderQty)||a.orderQty<a.moq?n.val(a.moq):a.orderQty>a.invQty&&0==a.isSupportBook?n.val(a.invQty):0<(e=a.orderQty%a.increment)&&a.orderQty!=a.invQty&&(e=a.orderQty-e+a.increment,0==a.isSupportBook&&e>a.invQty||1==a.isSupportBook&&a.orderQty<a.invQty&&e>a.invQty?e=a.invQty:1==a.noUnpacking&&layer.tips("<span style='color:black'>"+configData.ProductDetail.txt63+"</span>",n,{tips:[1,"white"],time:2e3}),a.orderQty=e,n.val(a.orderQty)),checkIfNeedBook(t),calcPriceAndAmount(t)}function checkIfNeedBook(t){t=getProductMetaData(t);1==t.isSupportBook&&t.orderQty>t.invQty&&layer.msg(configData.ProductDetail.txt62)}function calcPriceAndAmount(a){var t=getProductMetaData(a),n=t.orderQty,e=t.ladderModelList,r=$("#CurrencySymbol").val();"1"==$("#AllowShipToHK").val()&&"HK"==t.shipTo&&(e=t.hkLadderModelList,r="$"),e=e.reverse(),$.each(e,function(t,e){return!(parseInt(n)>=parseInt(e.Qty)&&(e=e.Price,a.find(".amount").text(r+" "+subZeroAndDot((e.toFixed(4)*n).toFixed(2))),1))})}function getProductMetaData(t){var e={productguid:t.find("input[name=productguid]").val(),sourcestockid:t.find("input[name=sourcestockid]").val(),model:t.find("input[name=model]").val(),brand:t.find("input[name=brand]").val(),package:t.find("input[name=package]").val(),batchno:t.find("input[name=batchno]").val(),invQty:parseInt(t.find("input[name=invqty]").val()),moq:parseInt(t.find("input[name=moq]").val()),spq:parseInt(t.find("input[name=spq]").val()),orderQty:parseInt(t.find("input[name=orderQty]").val()),noUnpacking:parseInt(t.find("input[name=noUnpacking]").val()),isSupportBook:parseInt(t.find("input[name=isSupportBook]").val()),ladderModelList:JSON.parse(t.find("input[name=ladderModelList]").val()),hkLadderModelList:JSON.parse(t.find("input[name=hkLadderModelList]").val()),productType:t.find("input[name=producttype]").val()},a="ShipTo_"+e.productguid.replace(/-/g,"");return e.minType=t.find("input[name=minType]").val(),"1"==e.minType?a="ShipTo_LowPrice":"2"==e.minType&&(a="ShipTo_LowDate"),e.shipTo=t.find("input[name="+a+"]:checked").val(),isNaN(e.spq)&&(e.spq=1),e.increment=1==e.noUnpacking?e.spq:1,e}function addToZiYing(t){var t=(isNull(t.currentTarget)?$(t):$(t.currentTarget)).parent().parent().find("[data-tag='oper']"),e=t.children("input[name='productguid']").val(),a=t.children("input[name='model']").val(),n=t.children("input[name='brand']").val(),r=t.children("input[name='package']").val(),i=t.children("input[name='batchno']").val(),o=t.children("input[name='invqty']").val(),c=t.children("input[name='title']").val(),d=t.children("input[name='spqPrice']").val(),l=t.parent().find(".lazy").attr("src"),t=(!isNull(l)&&-1<l.indexOf("/assets/")&&(l=""),t.parent().find(".fa-file-pdf-o").attr("href")),u=(!isNull(t)&&-1<t.indexOf("javaScript:;")&&(t=""),""),p=($.ajax({type:"Get",url:"/manage/Product/CheckLinkProductGuid?id="+e,dataType:"text",async:!1,success:function(t){u=t},error:function(){}}),"");p=isNull(u)?(a={Model:a,Brand:n,Package:r,Batchno:i,InvQty:o,SPQPrice:d,Title:c,ProductType:2,Currency:"RMB",SourceProductGuid:e,PicUrl:l,PicList:l,PdfList:t},a=JSON.stringify(a),"/manage/Product/ProductDetail?type=2&jsonData="+encodeURIComponent(a)):"/manage/Product/ProductDetail?type=2&ProductId="+u,$.modalOpen({id:"ProductDetail",title:"新增商品",url:p,width:"900px",height:"820px",callBack:function(t){top.frames[t].submitForm()}})}function onCorrection(t){var t=(isNull(t.currentTarget)?$(t):$(t.currentTarget)).parent().parent().find("[data-tag='oper']"),e=t.children("input[name='producttype']").val(),a=t.children("input[name='productguid']").val(),n=t.children("input[name='spqPrice']").val(),r=t.children("input[name='model']").val(),i=t.children("input[name='brand']").val(),o=t.children("input[name='moq']").val(),t=""!=t.children("input[name='isCorrect']").val();layer.open({title:configData.ProductDetail.txt39,type:2,area:["400px","320px"],fix:!0,maxmin:!1,content:"/Product/Correction?id="+a+"&type="+e+"&spqPrice="+n+"&model="+r+"&brand="+i+"&isCorrect="+t+"&moq="+o})}function onQuickAddLayer(t){var t=isNull(t.currentTarget)?$(t):$(t.currentTarget),e=t.parent(),a=e.children("input[name='customlinkurl']").val();if(!isNull(a))return a.indexOf("http:")<0&&a.indexOf("https:")<0&&0!=a.indexOf("/")&&(a="http://"+a),window.open().location.href=a,!1;var a=t.data("type"),t="payment"==a?configData.SearchList.txt95:configData.SearchList.txt42,n=e.children("input[name='producttype']").val(),r=e.children("input[name='productguid']").val(),e=e.children("input[name='minType']").val();layer.open({title:t,type:2,area:["650px","370px"],fix:!0,maxmin:!1,content:"/Product/ShowDetail?id="+r+"&location="+a+"&t="+n+"&minType="+e})}function onBomInquire(t){var t=isNull(t.currentTarget)?$(t):$(t.currentTarget),e=("1"===t.attr("data-tag")?t.parent():t).parent(),a=e.children("input[name='model']").val(),n=(checkSpechars(a)&&(a=specharsToBase64(a,!0)),e.children("input[name='brand']").val()),r=(checkSpechars(n)&&(n=specharsToBase64(n,!0)),e.children("input[name='package']").val()),e=(checkSpechars(r)&&(r=specharsToBase64(r,!0)),e.children("input[name='batchno']").val()),a=(checkSpechars(e)&&(e=specharsToBase64(e,!0)),"/Bom/BomInquire?model="+a);isNull(n)||(a+="&brand="+n),isNull(r)||(a+="&package="+r),isNull(e)||(a+="&batchNo="+e),t.attr("href",a)}function toLogin(){layer.confirm(configData.SearchList.txt62,{title:configData.Layer.txt1,btn:[configData.SearchList.txt61]},function(){location.href="/Account/Login?returnUrl="+location.href})}function viewInfo(t){$.modalOpen({id:"ProductDetail",title:"修改商品",url:"/manage/Product/ProductDetail?ProductId="+t+"&type=1",width:"900px",height:"820px",callBack:function(t){top.frames[t].submitForm()}})}function ajax_getSearchUrl(t,e){var a="";return $.ajax({type:"Post",url:"/Product/GetSearchUrl",dataType:"text",data:{query:t,urlPath:e},async:!1,success:function(t){a=t},error:function(){return a}}),a}!function(c){c(function(){function t(){var t=c("select[name='Sort']").val(),e=c("input[name='OrderBy'"),a=c(this).val(),a=("按单价"===a&&(1==e.val()?e.val(0):e.val(1)),"按库存量"===a&&(2==e.val()?e.val(0):e.val(2)),e.val()),n=(0<parseInt(t)&&0===parseInt(a)&&(a=1),new Object),a=(n.Brand=e.data("brand"),n.Package=e.data("package"),n.OrderBy=a,n.Sort=t,n.ModuleGuid=e.data("moduleguid"),n.ModuleName=e.data("modulename"),n.Guid=e.data("guid"),n.CategoryName=e.data("categoryname"),e.data("linklocation")),t=ajax_getSearchUrl(n,a);window.location.href=t}c(".listorder").on("click","input[type='button']",t).on("change","select[name='Sort']",t),window.onload=function(){c("input[type='radio']").iCheck({radioClass:"iradio_minimal-orange",increaseArea:"20%"})},c(".sc_pr_body").on("click","#QuickAdd",onQuickAdd).on("click","#BomInquire",onBomInquire).on("click","#Correction",onCorrection).on("click","#AddToZiYing",addToZiYing).on("blur","input[name=orderQty]",orderQtyBlur).on("click",".buy_less",orderQtyLess).on("click",".buy_add",orderQtyAdd).on("ifChecked","input[type='radio']",function(){calcPriceAndAmount(c(this).parents("ul"))}),c(".sct-body").on("click","#QuickAdd",onQuickAddLayer),c(".product_replace").click(function(){var o,t=c(this).parent().parent(),e=parseInt(c(this).data("count"));if(c(this).find("i").hasClass("up")){if(c(this).find("i").removeClass("up"),e<0)return!1;e++;for(var a=t,n=0;n<e;n++)(a=a.next()).hide()}else if(c(this).find("i").addClass("up"),"1"==c(this).data("ajax")){if(e<0)return!1;e++;for(a=t,n=0;n<e;n++)(a=a.next()).show()}else{var r=c(this).data("model"),i=c(this).data("brand");r=r,i=i,(o=t).find(".product_replace").attr("data-ajax","1"),c.ajax({url:"/Product/GetNewReplacedProducts",type:"Post",async:!0,data:{model:r,brand:i},dataType:"json",headers:{ct:rsaEncrypt(getCrawlerToken(!0))},beforeSend:function(t){layer_id=layer.load(0,{shade:[.1,"#000"]})},success:function(t){var e,a,n,r,i;"success"==t.state&&(0<t.data.length?((e={}).ProductList=t.data,e.AllowShipToHK="1"==c("#AllowShipToHK").val(),e.IsPicture="1"==c("#IsPicture").val(),e.IsCloud=!1,e.IsShareStock=!1,e.IsLoginVisiblePrice="1"==c("#IsLoginVisiblePrice").val(),e.IsLoginVisiblePDF="1"==c("#IsLoginVisiblePDF").val(),e.DefultPicUrl="/assets/img/pub/loading_1.gif",a=e,r=!(n=!1),i=c("#CurrencySymbol").val(),c.each(a.ProductList,function(t,e){n?0==t?(e.IsLowestPrice=!0,e.ShipToStr="ShipTo_LowPrice"):(e.IsLowestDate=!0,e.ShipToStr="ShipTo_LowDate"):(r&&(e.IsReplace=!0),e.ShipToStr="ShipTo_"+e.ProductGuid.replace(/-/g,"")),e.IsHasChina=isNull(e.ShipTo)||0<=e.ShipTo.indexOf("China"),e.IsHasHK=isNull(e.ShipTo)||0<=e.ShipTo.indexOf("HK"),e.CurrencySymbol=i,e.Amount=(e.OrderQty*e.OrderPrice).toFixed(2),a.AllowShipToHK&&e.IsHasHK&&!e.IsHasChina&&(e.CurrencySymbol="$"),e.LadderModelListStr=JSON.stringify(e.LadderModelList),e.HKLadderModelListStr=JSON.stringify(e.HKLadderModelList),e.NoUnpackingStr=e.NoUnpacking?"1":"0",e.IsSupportBookStr=e.IsSupportBook?"1":"0"}),e=Handlebars.compile(c("#ProductDetails").html())(a),o.after(e+='<ul class="pr_replace_title"></ul>'),o.parent().find("img.lazy").lazyload({effect:"fadeIn",threshold:100,noPictureUrl:c("#NoPicture").val()})):o.find(".product_replace").html(configData.SearchList.txt118).addClass("not color-lightgray").removeClass("color-theme"),o.find(".product_replace").attr("data-count",t.data.length))},complete:function(t,e){layer.close(layer_id)}})}})}),Handlebars.registerHelper("fixed",function(t,e){return null==t||""==t||"undefined"==t?0:t.toFixed(4)}),Handlebars.registerHelper("IsBuy",function(t,e){return isCanBuy(t)?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("IsHasAndChina",function(t,e){return t.IsHasChina&&t.IsHasHK?"":"dis"})}(jQuery);